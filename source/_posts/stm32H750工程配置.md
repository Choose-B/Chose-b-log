---
title: stm32H750工程配置
tag:
  - 笔记
  - stm32
hide: false
achieve: true
index_img: 
mathjax: false
excerpt: 'RM笔记2-1:使用STM32CuBeMX初始化一个新的工程文件'
date: 2025-10-15 10:36:12
category: RoboMaster
---
## 前置要求
下载安装好`STM32CuBeMX`

## 基础配置
打开`STM32CuBeMX`,找到`File -> New Project`  
在`Commercial Part Number`中检索我们所使用的芯片`STM32H750VBT6`  
点击`Start Project`来新建工程  
![](/img/RM-Note/2-1-1.png)  
> 中间如果出现对话框点击`yes`即可  


由于芯片自带的计时器不够精确，因此使用外部晶振器给芯片提供时钟信号  
为了完成这个配置,我们需要打开`Pinout & Configuration -> System Core -> RCC`  
在面板上的`Mode -> High Speed Clock(HSC)`中选择 `Crystal/Ceramic Resonator`启用外部晶振器  
并在`Configuration -> Parameter Settings -> Power Regulator Voltage Scale`选择`Power Regulator Voltage Scale 0`  
![](/img/RM-Note/2-1-2.png)   


接着配置时钟树  
转到`Clock Configuration`面板  
修改最左边`Input frequency`的值为8  
修改 标注了`480 MHz max`的框内的值为480  
回车后STM32CubeMX会自动分配数值,稍等片刻即可  
> 中间如果出现对话框点击`yes`即可  

![](/img/RM-Note/2-1-3.png)  

## 定时器中断配置
来到`Pinout & Configuration -> Timers -> TIM14`  
点击`Activated`来启用TIM14,这时就可以在`Configuration -> Parameter Settings`中设置了  
|要修改的参数|修改为|
|---|---|
|Prescaler|240-1|
|Counter Period|1000-1|

这样定时器每1ms就会中断1次  
![](/img/RM-Note/2-1-4.png)  
还要在`Configuration -> NVIC Settings`中点击`Enable`选项打开定时器中断  
![](/img/RM-Note/2-1-5.png)

## 串口中断配置
来到`Pinout & Configuration -> Connectivity -> UART5`  
修改通信模式`Mode`为`Asynchronous`(异步通信),Baud Rate(波特率)需要发送和接受的两个设备一致,此处发送和接受是同一个设备,所以不用管了  
然后在`NVIC Settings`打开串口中断(点击`Enabled`)   
![](/img/RM-Note/2-1-6.png)

{% fold info @还可以加入DMA %}
但是第二次培训没有演示  
~~先挖个坑在这里~~  
~~嘻嘻~~
{% endfold %}  

`System Core -> NVIC`中可以看到所有的中断及其优先级(`preemption priority`),数值越小优先级越高
![](/img/RM-Note/2-1-7.png)

## CAN参数配置
来到`Pinout & Configuration -> Connectivity -> FDCAN1`,先勾选
{% cb Activated, false, false %}  
同样要在`NVIC Settings`里打开中断  
![](/img/RM-Note/2-1-10.png)  
接下来跳到`Parameter Settings`
先配置`basic parammeter`参数  
将以下项的值修改为我们需要的值:  
|需要修改的量|修改后的值|
|---|---|
|Nominal Sync Jump Width|8|
|Rx Fifo0 Elmts Nbr|32|
|Tx Fifo0 Queue Elmts Nbr|10|

![basic parammeter](/img/RM-Note/2-1-11.png)

然后配置下面的`Bit Timings Parameters`  
在Bit Timings Parameters界面中，需要进行CAN的波特率的配置，在B设置完分频系数 (Prescaler) 后，cubeMX 会自动完成 Time Quantum（简写为 tq）的计算，将 tq 乘以 seg1 (Time Quanta in Bit Segment 1)，seg2 (Time Quanta in Bit Segment 1)，再加一的和刚好为 1 微秒，对应波特率为 1M，这是 CAN 总线支持的最高通讯速率。  
|需要修改的量|修改后的值|
|---|---|
|Nominal Prescaler|3|
|Nominal Time Seg1|31|
|Nominal Time Seg1|8|

![Bit Timings Parameters](/img/RM-Note/2-1-12.png)

{% note warning %}
**提醒**  
在这里请**务必检查**每比特的标称时间`Nominal Time for one Bit`和波特率`Nominal Baud Rate`和图片中是否一致  
{% endnote %}  

{% fold info @那如果不一致怎么办？ %}
以下有几种方法:  
1. 检查时钟树`Clock Configuratoin`是否正确。如果时钟树和前文的配置不一致，修改过来  
2. 在时钟树里修改frcan的分频把tq大小配置为25ns
3. 调整参数`seg1`和`seg2`,使得每比特的标称时间`Nominal Time for one Bit`和波特率`Nominal Baud Rate`和图片中一致
{% endfold %}  

如果还打开了`FDCAN2`,那么就在`Pinout & Configuration -> System Core -> NVIC`中修改中断优先级  
这里以`CAN1`作为主CAN  
![](/img/RM-Note/2-1-13.png)

## 生成工程
打开`Project Manager`,自行修改`Project Name`和`Project Location`  
`Toolchain/IDE`要选择`MDK-ARM`,版本`Min Version`选`V5`  
接着在`Project Maneger -> Code Generator -> Generated files`中勾选第一个选项  
{% cb Generate peripheral initialization as a pair of ".c/.h" files per peripheral, false, false %}   
这样做就可以在生成代码的时候让不同功能的代码在不同的文件中，便于查找和修改  
![](/img/RM-Note/2-1-8.png)
![](/img/RM-Note/2-1-9.png)
最后点击右上角的`Generate Code`即可生成代码  
{% note warning %}
**提醒!**   
首次生成代码时会提示需要登录,跟随指引注册即可  
如果跳过注册登录生成代码,CubeMX不会生成Keil的工程文件(.uvprojx)而只生成代码   
Keil只能打开后缀为`.uvprojx`的文件,不能直接打开`.c`或者文件夹哦  
{% endnote %}   
{% note secondary %}
**提示**   
最后成功生成的对话框应该点击`Open Project`来直接打开Keil
{% endnote %}  

---END---
---


参考:
[stm32H750工程配置，定时器中断与串口收发通信（中断与DMA）测试](https://blog.csdn.net/m0_74329410/article/details/141297841)
[stm32H750转RM3508电机（纯实践教程）](https://blog.csdn.net/m0_74329410/article/details/140553378)